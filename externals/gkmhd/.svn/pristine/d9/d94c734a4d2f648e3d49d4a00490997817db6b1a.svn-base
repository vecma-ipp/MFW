!...  set remaining 1d profiles

  pressure_eq => eq%profiles_1d%pressure
  jphi_eq => eq%profiles_1d%jphi
  parea => eq%profiles_1d%beta_pol
  wmag => eq%profiles_1d%li
  volume => eq%profiles_1d%volume

  ALLOCATE(pvol(nr_eq))
  ALLOCATE(ip_tor(nr_eq))
  ALLOCATE(barea(nr_eq))
  ALLOCATE(length(nr_eq))
  ALLOCATE(bpol(nr_eq))

  pvol(1)=0.
  parea(1)=0.
  wmag(1)=0.
  ip_tor(1)=0.
  length(1)=0.
  bpol(1)=0.
  barea(1)=0.

  DO i0=2,nr_eq
     i1=i0-1
     darea=0.5*(eq%profiles_1d%area(i0)-eq%profiles_1d%area(i1))
     dvol=0.5*(eq%profiles_1d%volume(i0)-eq%profiles_1d%volume(i1))
     pvol(i0) = pvol(i1) + dvol * (pressure_eq(i0)+pressure_eq(i1))
     parea(i0) = parea(i1) + darea * (pressure_eq(i0)+pressure_eq(i1))
!     wmag(i0) = wmag(i1) + dvol * 
     ip_tor(i0) = ip_tor(i1) + darea * (jphi_eq(i0)+jphi_eq(i1))

     length(i0)=SUM( SQRT( (rr_eq(i0,:)-CSHIFT(rr_eq(i0,:),-1))**2.0 &
          + (zz_eq(i0,:)-CSHIFT(zz_eq(i0,:),-1))**2.0 ) )

     barea(i0)=mu_0*ip_tor(i0)/length(i0)
  END DO
  parea=parea/area
  pvol=pvol/volume
  wmag=wmag/(mu_0*ip_tor*ip_tor)
  wmag=(2.0/mu_0)*wmag*(tpi*area/volume)

  eq%profiles_1d%beta_pol=eq%profiles_1d%pressure/eq%profiles_1d%area
  eq%profiles_1d%beta_pol(1)=eq%profiles_1d%pressure(1)

!  eq%profiles_1d%li=0.
!  eq%profiles_1d%li(1)=eq%profiles_1d%li(1)

